stages:
  - test
  - deploy


test:
  stage: test
  image: python
  script:
    - apt-get -q update
    - apt-get -yq install firefox-esr
    - apt-get -yq install Xvfb
    - pip install -r requirements.txt
    - initial_dir=`pwd`
    - cd /usr/bin
    - wget https://github.com/mozilla/geckodriver/releases/download/v0.16.0/geckodriver-v0.16.0-linux64.tar.gz
    - tar -xvzf geckodriver*
    - chmod +x geckodriver
    - cd $initial_dir
    - export DISPLAY=:1
    - python manage.py test
